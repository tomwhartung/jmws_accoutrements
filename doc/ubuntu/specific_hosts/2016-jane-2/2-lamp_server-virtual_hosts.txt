
 Get LAMP Sites Running
========================
LAMP as in LAM-PHP.  We do Python separately.

Ensure Required LAMP Packages Are Installed
-------------------------------------------
Some of these LAMP packages may or may not yet be installed.
[ ] Install as necessary, and ensure the installed versions of these packages match on:
    [ ] ava
    [ ] barbara
    [ ] jane
    Commands (as root):
      dpkg-query -l 'package_name_or_regex'   ## if it's not found, it needs to be installed
      apt-get install -s package_name         ## Simulate installation
      apt-get install -y package_name         ## Do it without requesting confirmation
    Install apache2, apache2-utils, apache2-dev (needed for wsgi)
    Install libapache2-mod-php7.0
    Install php7.0, php7.0-gd, php7.0-mysql, php7.0-mcrypt
    Install mysql-server

Populate /var/www
-----------------
[ ] Get all websites' source files in /var/www
    artsyvisions.com:
      best to use a tar file
    exp (jane only):
      best to use a tar file
    github_pages:
      mkdir -p github_pages/customizations
      cd github_pages/customizations
      git clone git@github.com:JoomooWebsites/joomoowebsites.github.io.git
      git clone git@github.com:tomwhartung/tomwhartung.github.io.git
      cd -
    groja.com:
      mkdir -p groja.com/htdocs
      cd groja.com/htdocs
      git clone git@github.com:tomwhartung/groja.com.git
      cd -
    jmws_accoutrements:
      git clone git@github.com:tomwhartung/jmws_accoutrements.git
    joomoowebsites.com:
      best to use a tar file (copy from barbara; bette has more files e.g., downloads dir.)
    learn (jane only):
      best to use a tar file (copy from bette)
    seeourminds.com:
      mkdir -p seeourminds.com/htdocs/
      cd seeourminds.com/htdocs/
      git clone git@github.com:tomwhartung/seeourminds.com.git
      cd -
    subsites:
      mkdir subsites
      cd subsites
      git clone git@github.com:tomwhartung/resume.git
      git clone git@github.com:tomwhartung/idMyGadget.git
      cd -
    tomhartung.com:
      ** COME BACK TO THIS LATER **
      -> Get it working on barbara, then copy only essential code to ava and jane
      For now: add only a placeholder html file to the DocumentRoot directory
      mkdir -p tomhartung.com/htdocs/tomhartung.com
      vi tomhartung.com/htdocs/tomhartung.com/index.html
    tomh.info
      best to use a tar file
    tomwhartung.com:
      -> Ensure it works on barbara, then copy only essential code to ava and jane
      For now: add only a placeholder html file to the DocumentRoot directory
      mkdir -p tomwhartung.com/htdocs/tomhartung.com
      vi tomwhartung.com/htdocs/tomhartung.com/index.html

Disk Space Spotcheck
--------------------
[ ] Disk Space Spotcheck:
    /:        6.3G/23G (29%)
    /home:    1.1G/23G (5%)
    /var/www: 9.1G/19G (53%)
NOTE: if we need space in /var/www, we can delete files in:
    /var/www/zzz-tar_files-old

Configure Apache
----------------
[ ] Add and update config files in /etc/apache2/sites-available as appropriate
    As root:
      cd /etc/apache2/sites-available
      mkdir RCS
      ci -l *.conf   ## "Installed version"
    For best results, copy conf files from another host and check in to RCS
    Fix ServerAlias specifications in apache2/sites-available/*.conf files
    As root:
      ci -l *.conf   ## "Copied from host xxxxx and updated for this host"
[ ] Enable mod_rewrite and php7.0, and start apache2 (as root):
    As root:
      cd /etc/apache2
      ls -al mods-*/rewrite*
      ls -al mods-*/php7.0*
      ls -al mods-*/mpm*
    If not enabled (or disabled, as in the case of mpm_event),
      run one or more of these commands as appropriate:
    As root:
      a2enmod rewrite
      a2enmod php7.0
      a2dismod mpm_event
      a2enmod mpm_prefork
[ ] Check that we have not yet enabled any sites:
    As root:
      cd /etc/apache2
      ls -al l sites*/*.conf
    Only the sites-available/000-default.conf file should be linked to
      the sites-enabled directory
[ ] Restart apache and test in browser, to ensure we are good to go.
    As root:
      service apache2 stop
      service apache2 start
    Access in browser:
      http://localhost
    Should see our customary behind-the-firewall version of index.html

Ensure Static Sites Work
------------------------
[ ] artsyvisions.com
    As root:
      a2ensite 010-artsyvisions.com.conf
      service apache2 stop
      service apache2 start
      l sites*/*.conf
    Should see the sites-available/010-artsyvisions.com.conf file linked to
      the sites-enabled directory
    Access in browser:
      http://jane.artsyvisions.com
[ ] tomh.info
    As root:
      a2ensite 070-tomh.info.conf
      service apache2 stop
      service apache2 start
      l sites*/*.conf
    Should see the sites-available/070-tomh.info.conf file linked to
      the sites-enabled directory
    Access in browser:
      http://jane.tomh.info
So far so good, I hope.  And this is where the fun starts!

Finding the Right Copy of the Database
--------------------------------------
[ ] Databases used on barbara:
    groja.com & seeourminds.com:
      try using current db from lauren:
        seeourminds.com-2016_07_16-lauren.sql.gz
      try using current db from bette:
        seeourminds.com-2016_07_16-bette.sql.gz
    joomoowebsites.com: using db from bette (version 3.5.1)
        joomoowebsites.com-2016_07_16-bette-02-mobile_detect.sql.gz
    tomhartung.com: using db from bette
        tomwhartung.com-2016_07_16-bette.sql.gz

Overview of Process for CMS Sites
---------------------------------
1. Ensure it is working on barbara (or bette or lauren)
2. Copy code and db to jane
3. Ensure it works on jane
4. Cleanup: delete as many files as possible (downloads, old releases, tmp dirs., etc.)
5. Ensure it still works on jane
6. Copy code and db to ava
7. Ensure it works on ava
8. Consider cleaning up downloads, etc. on barbara as well

Ensure WordPress Site Works
---------------------------
Site: tomwhartung.com
[ ] Create and restore database
    See ~/technical/cmses/wordpress
[ ] Enable site and restart apache
    As root:
      a2ensite 080-tomwhartung.com.conf
      service apache2 stop
      service apache2 start
[ ] Edit wp-config.php and update Settings -> URLs in back end
    Chrome browser redirect issue:
      Menu -> More Tools -> Clear Browsing Data
[ ] Configure wordpress updates
    See ~/technical/cmses/wordpress/README.txt

Ensure Joomla Site Works
-------------------------
Site: joomoowebsites.com
[ ] Create and restore database
    See ~/technical/cmses/wordpress
[ ] Enable site and restart apache
    As root:
      a2ensite 040-joomoowebsites.com.conf
      service apache2 stop
      service apache2 start
[ ] For joomla on a fresh install of 16.04, install simplexml:
    Check for it in phpinfo.php - it has its own section
    If it is not installed:
    As root:
      apt-get install php7.0-simplexml
      service apache2 restart
    Reference: http://forum.joomla.org/viewtopic.php?t=916040
[ ] To fix "The file Cache Storage is not supported on this platform." error:
    As root:
      cd /var/www/joomoowebsites.com/htdocs/joomoowebsites.com
      chgrp www-data cache/ administrator/cache/ tmp

Ensure Drupal Site Works
------------------------
Site: tomhartung.com

[ ] Create and restore database: see database_checklist.txt
[ ] Get sites running: see site_checklist.txt

Back It All Up
--------------
[ ] Ensure we have backups of everything, including a copy for off-site
[ ] Set up (semi-)automatic backups as appropriate


[ ] Disk Space Spotcheck:
    /:     
    /home: 
    /var/www: X.XG/XXG (XX%)

