#!/bin/bash
#
# dbBackupAll: backup all mysql dbs on localhost
# ----------------------------------------------
#
function badSyntax
{
   echo 'Syntax: dbBackupAll [password]'
   echo '  Saves a copy of all dbs in ~tomh/backup/db'
   echo '  To backup a specific DB, use dbBackup'
}

if [ $# -gt 1 ]; then
   badSyntax
   exit 1
fi

password=$1
umask 077
date=$(date +'%Y_%m_%d')
hostname=$(hostname)
sitename='AllSites'

backup_file_name="${sitename}-${date}-${hostname}.sql.gz"
backup_dir=~tomh/backup/db

echo "sitename = \"$sitename\""
echo "date = \"$date\""
echo "password = \"$password\""
echo "backup_file_name = \"$backup_file_name\""
echo "backup_dir = \"$backup_dir\""

cd $backup_dir
echo "Backing up $sitename site DB to ${backup_dir}/${backup_file_name} ..."
mysqldump --quick --opt -u root -p${password} --all-databases | gzip > $backup_file_name
echo "... done."

